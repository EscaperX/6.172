**Homework 2: Profiling Serial Merge Sort**

The homework is done on a cloud server, because perf can't work normally on WSL.

Checkoff item 1
===============

Checkoff item 2
===============

Valgrind result on my cloud server:
~~~
==8389== Cachegrind, a cache and branch-prediction profiler
==8389== Copyright (C) 2002-2017, and GNU GPL'd, by Nicholas Nethercote et al.
==8389== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info
==8389== Command: ./sum
==8389==
--8389-- warning: L3 cache found, using its data for the LL simulation.
--8389-- warning: specified LL cache: line_size 64  assoc 11  total_size 34,603,008
--8389-- warning: simulated LL cache: line_size 64  assoc 17  total_size 35,651,584
Allocated array of size 10000000
Summing 100000000 random values...
Done. Value = 938895920
==8389==
==8389== I   refs:      3,440,227,866
==8389== I1  misses:            1,196
==8389== LLi misses:            1,181
==8389== I1  miss rate:          0.00%
==8389== LLi miss rate:          0.00%
==8389==
==8389== D   refs:        610,074,467  (400,058,409 rd   + 210,016,058 wr)
==8389== D1  misses:      100,548,114  ( 99,922,243 rd   +     625,871 wr)
==8389== LLd misses:       11,593,694  ( 10,967,892 rd   +     625,802 wr)
==8389== D1  miss rate:          16.5% (       25.0%     +         0.3%  )
==8389== LLd miss rate:           1.9% (        2.7%     +         0.3%  )
==8389==
==8389== LL refs:         100,549,310  ( 99,923,439 rd   +     625,871 wr)
==8389== LL misses:        11,594,875  ( 10,969,073 rd   +     625,802 wr)
==8389== LL miss rate:            0.3% (        0.3%     +         0.3%  )
==8389==
==8389== Branches:        210,043,923  (110,043,419 cond + 100,000,504 ind)
==8389== Mispredicts:           5,488  (      5,280 cond +         208 ind)
==8389== Mispred rate:            0.0% (        0.0%     +         0.0%   )
~~~

Valgrind result on my WSL:
~~~
==12895== Cachegrind, a cache and branch-prediction profiler
==12895== Copyright (C) 2002-2017, and GNU GPL'd, by Nicholas Nethercote et al.
==12895== Using Valgrind-3.15.0 and LibVEX; rerun with -h for copyright info
==12895== Command: ./sum
==12895==
--12895-- warning: L3 cache found, using its data for the LL simulation.
--12895-- warning: specified LL cache: line_size 64  assoc 10  total_size 26,214,400
--12895-- warning: simulated LL cache: line_size 64  assoc 13  total_size 27,262,976
Allocated array of size 10000000
Summing 100000000 random values...
Done. Value = 938895920
==12895==
==12895== I   refs:      3,540,234,109
==12895== I1  misses:            1,217
==12895== LLi misses:            1,200
==12895== I1  miss rate:          0.00%
==12895== LLi miss rate:          0.00%
==12895==
==12895== D   refs:        610,071,882  (400,055,008 rd   + 210,016,874 wr)
==12895== D1  misses:      100,507,402  ( 99,881,533 rd   +     625,869 wr)
==12895== LLd misses:       32,616,757  ( 31,990,944 rd   +     625,813 wr)
==12895== D1  miss rate:          16.5% (       25.0%     +         0.3%  )
==12895== LLd miss rate:           5.3% (        8.0%     +         0.3%  )
==12895==
==12895== LL refs:         100,508,619  ( 99,882,750 rd   +     625,869 wr)
==12895== LL misses:        32,617,957  ( 31,992,144 rd   +     625,813 wr)
==12895== LL miss rate:            0.8% (        0.8%     +         0.3%  )
==12895==
==12895== Branches:        210,044,247  (110,043,716 cond + 100,000,531 ind)
==12895== Mispredicts:           5,364  (      5,140 cond +         224 ind)
==12895== Mispred rate:            0.0% (        0.0%     +         0.0%   )
~~~

Write-up 1
==========
test command: valgrind --tool=cachegrind --branch-sim=yes ./sort 100 10

Make with O3:
~~~
==8421==
==8421== I   refs:      2,315,009
==8421== I1  misses:        1,579
==8421== LLi misses:        1,468
==8421== I1  miss rate:      0.07%
==8421== LLi miss rate:      0.06%
==8421==
==8421== D   refs:        859,572  (531,084 rd   + 328,488 wr)
==8421== D1  misses:        4,292  (  3,370 rd   +     922 wr)
==8421== LLd misses:        3,230  (  2,417 rd   +     813 wr)
==8421== D1  miss rate:       0.5% (    0.6%     +     0.3%  )
==8421== LLd miss rate:       0.4% (    0.5%     +     0.2%  )
==8421==
==8421== LL refs:           5,871  (  4,949 rd   +     922 wr)
==8421== LL misses:         4,698  (  3,885 rd   +     813 wr)
==8421== LL miss rate:        0.1% (    0.1%     +     0.2%  )
==8421==
==8421== Branches:        394,060  (376,109 cond +  17,951 ind)
==8421== Mispredicts:      25,145  ( 24,789 cond +     356 ind)
==8421== Mispred rate:        6.4% (    6.6%     +     2.0%   )
~~~

Make with DEBUG=1
~~~
==8440==
==8440== I   refs:      3,355,991
==8440== I1  misses:        1,539
==8440== LLi misses:        1,451
==8440== I1  miss rate:      0.05%
==8440== LLi miss rate:      0.04%
==8440==
==8440== D   refs:      1,953,161  (1,402,482 rd   + 550,679 wr)
==8440== D1  misses:        4,264  (    3,341 rd   +     923 wr)
==8440== LLd misses:        3,221  (    2,408 rd   +     813 wr)
==8440== D1  miss rate:       0.2% (      0.2%     +     0.2%  )
==8440== LLd miss rate:       0.2% (      0.2%     +     0.1%  )
==8440==
==8440== LL refs:           5,803  (    4,880 rd   +     923 wr)
==8440== LL misses:         4,672  (    3,859 rd   +     813 wr)
==8440== LL miss rate:        0.1% (      0.1%     +     0.1%  )
==8440==
==8440== Branches:        422,541  (  404,646 cond +  17,895 ind)
==8440== Mispredicts:      31,459  (   31,129 cond +     330 ind)
==8440== Mispred rate:        7.4% (      7.7%     +     1.8%   )
~~~

Write-up 2
==========
Test command: time valgrind --tool=cachegrind --branch-sim=yes ./sort 10000 10


No Inline and sort_i only:
~~~
==9247==
==9247== I   refs:      308,789,072
==9247== I1  misses:          1,578
==9247== LLi misses:          1,467
==9247== I1  miss rate:        0.00%
==9247== LLi miss rate:        0.00%
==9247==
==9247== D   refs:      200,440,636  (151,499,890 rd   + 48,940,746 wr)
==9247== D1  misses:        463,667  (    236,406 rd   +    227,261 wr)
==9247== LLd misses:         36,038  (      2,414 rd   +     33,624 wr)
==9247== D1  miss rate:         0.2% (        0.2%     +        0.5%  )
==9247== LLd miss rate:         0.0% (        0.0%     +        0.1%  )
==9247==
==9247== LL refs:           465,245  (    237,984 rd   +    227,261 wr)
==9247== LL misses:          37,505  (      3,881 rd   +     33,624 wr)
==9247== LL miss rate:          0.0% (        0.0%     +        0.1%  )
==9247==
==9247== Branches:       32,860,221  ( 31,679,780 cond +  1,180,441 ind)
==9247== Mispredicts:     2,389,528  (  2,389,200 cond +        328 ind)
==9247== Mispred rate:          7.3% (        7.5%     +        0.0%   )
./sort 262144 2

Running test #0...
Generating random array of 262144 elements
Arrays are sorted: yes
 --> test_correctness at line 217: PASS
sort_i          : Elapsed execution time: 0.072631 sec
Generating inverted array of 262144 elements
Arrays are sorted: yes
 --> test_correctness at line 217: PASS
sort_i          : Elapsed execution time: 0.116887 sec

Running test #1...
 --> test_zero_element at line 245: PASS

Running test #2...
 --> test_one_element at line 266: PASS
Done testing.

real    0m2.807s
user    0m2.576s
sys     0m0.098s
~~~


<!-- Markdeep: --><style class="fallback">body{visibility:hidden;white-space:pre;font-family:monospace}</style><script src="markdeep.min.js" charset="utf-8"></script><script src="https://morgan3d.github.io/markdeep/latest/markdeep.min.js" charset="utf-8"></script><script>window.alreadyProcessedMarkdeep||(document.body.style.visibility="visible")</script>
